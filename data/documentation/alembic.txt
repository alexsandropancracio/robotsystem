root@fd59f3d2388b:/app# python - << 'EOF'
import alembic
import alembic.config
print("Alembic import OK:", alembic.__version__)
EOF
Traceback (most recent call last):
  File "<stdin>", line 2, in <module>
ModuleNotFoundError: No module named 'alembic.config'

Perfeito. Agora ficou cristalino ğŸ”¥
Esse output muda tudo â€” e confirma que o problema Ã© mais profundo que o CLI.

âŒ ModuleNotFoundError: No module named 'alembic.config'
mesmo ao importar direto pelo Python

Isso NUNCA deveria acontecer em uma instalaÃ§Ã£o vÃ¡lida do Alembic.

EntÃ£o vamos ao diagnÃ³stico real, sem rodeio.

ğŸš¨ DIAGNÃ“STICO DEFINITIVO

ğŸ‘‰ O pacote alembic instalado no seu container NÃƒO Ã© o Alembic real
ou
ğŸ‘‰ Existe um conflito de namespace chamado alembic dentro do projeto ou do sistema

Porque:

O mÃ³dulo alembic.config sempre existe no Alembic oficial

Se ele nÃ£o existe:

ou o pacote foi sobrescrito

ou tem um arquivo/pasta chamada alembic â€œna frenteâ€ do Python

ou a instalaÃ§Ã£o estÃ¡ corrompida por imagem base

ğŸ§ª PROVA TÃ‰CNICA (VAMOS VER O QUE O PYTHON ESTÃ IMPORTANDO)

Roda isso exatamente assim no container:

python - << 'EOF'
import alembic
print(alembic)
print(alembic.__file__)
print(dir(alembic))
EOF


ğŸ‘‰ Isso vai nos dizer QUAL alembic estÃ¡ sendo importado.

âš ï¸ Aposto alto que a saÃ­da vai mostrar algo como:

/app/alembic/__init__.py

ou /app/alembic.py

ou algo que nÃ£o seja site-packages/alembic/

ğŸ”¥ CAUSA MAIS COMUM (90% DOS CASOS)

VocÃª tem isso no projeto:

/app/alembic/


Ou seja:

ğŸ“ a pasta de migrations chama alembic
ğŸ“¦ o pacote Python tambÃ©m chama alembic

ğŸ‘‰ Resultado:
o Python importa a pasta do projeto, nÃ£o a lib

E essa pasta NÃƒO tem config.py â†’ ğŸ’¥

âœ… CONFIRMAÃ‡ÃƒO RÃPIDA

Roda:

ls /app | grep alembic


Se aparecer:

alembic


âš ï¸ Achamos o vilÃ£o.

ğŸ’£ POR QUE ISSO QUEBROU TUDO?

Porque vocÃª tem:

/app/alembic/          â† pasta de migrations
/usr/local/lib/.../alembic/  â† lib real


E o Python SEMPRE prioriza o diretÃ³rio atual (/app) no sys.path.

Resultado:

import alembic
# importa a pasta de migrations ğŸ¤¡

ğŸ› ï¸ SOLUÃ‡ÃƒO PROFISSIONAL (100% CORRETA)
OPÃ‡ÃƒO A â€” RECOMENDADA (PADRÃƒO REAL)

ğŸ‘‰ Renomear a pasta de migrations

Exemplo:

mv alembic migrations


Depois ajuste no alembic.ini:

script_location = migrations


E no comando:

python -m alembic -c alembic.ini current

OPÃ‡ÃƒO B â€” CONTORNO (MENOS LIMPO)

No env.py, remover /app do sys.path (nÃ£o recomendo no seu caso).

ğŸ§  POR QUE ISSO PASSOU BATIDO?

Porque:

o Alembic CLI tenta importar alembic.config

mas cai na pasta de migrations

que NÃƒO tem config.py

e explode

Isso Ã© um erro clÃ¡ssico, atÃ© dev sÃªnior cai nisso em Docker.

âœ… CHECKLIST DE CORREÃ‡ÃƒO

Depois de renomear:

python - << 'EOF'
import alembic
import alembic.config
print("Alembic OK:", alembic.__version__)
EOF


SaÃ­da esperada:

Alembic OK: 1.18.0

ğŸš€ DEPOIS DISSO

AÃ­ sim:

python -m alembic current
python -m alembic revision --autogenerate -m "initial schema"
python -m alembic upgrade head


Sem erro. Sem gambiarra. Sem fantasma.

ğŸ¯ ConclusÃ£o (IMPORTANTE)

âŒ NÃ£o era Docker
âŒ NÃ£o era pip
âŒ NÃ£o era versÃ£o
âŒ NÃ£o era vocÃª

âœ… Era conflito de namespace (alembic/)

Agora faz o teste do ls /app | grep alembic
Me manda o output que eu jÃ¡ te digo exatamente qual passo seguir ğŸ‘ŠğŸ”¥

root@fd59f3d2388b:/app# python - << 'EOF'
import alembic
import alembic.config
print("Alembic import OK:", alembic.__version__)
EOF
Traceback (most recent call last):
  File "<stdin>", line 2, in <module>
ModuleNotFoundError: No module named 'alembic.config'
root@fd59f3d2388b:/app# python - << 'EOF'
import alembic
print(alembic)
print(alembic.__file__)
print(dir(alembic))
EOF
<module 'alembic' from '/app/alembic/__init__.py'>
/app/alembic/__init__.py
['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__']
root@fd59f3d2388b:/app# ls /app | grep alembic
alembic
alembic.ini

EntÃ£o, pra vocÃª analisar de fato o que estÃ¡ acontecendo...

Perfeito. Agora temos prova irrefutÃ¡vel do que estÃ¡ acontecendo.
Isso aqui Ã© o ponto-chave ğŸ‘‡

<module 'alembic' from '/app/alembic/__init__.py'>


Ou seja:

ğŸš¨ O Python NÃƒO estÃ¡ importando o Alembic da lib

Ele estÃ¡ importando a sua pasta de migrations /app/alembic

ğŸ¯ O PROBLEMA (100% CONFIRMADO)

VocÃª tem DOIS â€œalembicsâ€:

ğŸ“¦ Biblioteca real

/usr/local/lib/python3.10/site-packages/alembic/


ğŸ“ Pasta do projeto (migrations)

/app/alembic/


O Python sempre prioriza o diretÃ³rio atual (/app) no sys.path, entÃ£o:

import alembic


vira:

import /app/alembic   âŒ


Essa pasta nÃ£o tem config.py, por isso:

ModuleNotFoundError: No module named 'alembic.config'


ğŸ‘‰ NÃ£o Ã© bug
ğŸ‘‰ NÃ£o Ã© versÃ£o
ğŸ‘‰ NÃ£o Ã© Docker
ğŸ‘‰ Ã‰ conflito de namespace clÃ¡ssico

ğŸ› ï¸ SOLUÃ‡ÃƒO CORRETA (SEM GAMBIARRA)
âœ… Passo 1 â€” Renomear a pasta alembic/

Dentro do container (ou no host):

mv /app/alembic /app/migrations


Agora vocÃª terÃ¡:

/app/migrations
/app/alembic.ini

âœ… Passo 2 â€” Ajustar o alembic.ini

Abra o arquivo:

nano alembic.ini


Altere somente esta linha:

script_location = migrations


(antes era alembic)

Salva.

âœ… Passo 3 â€” Teste de sanidade (ESSENCIAL)

Agora roda:

python - << 'EOF'
import alembic
import alembic.config
print("Alembic OK:", alembic.__version__)
print("Alembic path:", alembic.__file__)
EOF

âœ… SaÃ­da esperada:

Algo como:

Alembic OK: 1.18.0
Alembic path: /usr/local/lib/python3.10/site-packages/alembic/__init__.py


ğŸ‘‰ Se isso acontecer: problema resolvido definitivamente

âœ… Passo 4 â€” CLI volta a funcionar
alembic --version
alembic current


Sem erro.

ğŸš€ AGORA SIM: MIGRATIONS
1ï¸âƒ£ Ver estado atual
alembic current

2ï¸âƒ£ Criar migration
alembic revision --autogenerate -m "create activation_tokens table"

3ï¸âƒ£ Aplicar no banco
alembic upgrade head


Depois:

\dt


E a tabela activation_tokens vai aparecer ğŸ§ ğŸ”¥

ğŸ§  POR QUE ISSO ACONTECE COM TODO MUNDO?

Porque o Alembic por padrÃ£o cria a pasta chamada alembic/
e o Python nÃ£o protege contra shadowing de pacotes.

Ã‰ um erro tÃ£o comum que:

devs seniores jÃ¡ caÃ­ram

times inteiros jÃ¡ perderam horas nisso

vocÃª sÃ³ aprende quando dÃ³i ğŸ˜…

Agora vocÃª nunca mais cai nisso.