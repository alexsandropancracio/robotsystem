üìÑ RELAT√ìRIO T√âCNICO ‚Äì Migra√ß√£o de QWebChannel para PyWebview com API Integrada
1. Introdu√ß√£o

O projeto RobotSystem inicialmente utilizava QWebChannel para comunica√ß√£o entre o c√≥digo JavaScript da interface (HTML/JS) e a l√≥gica escrita em Python.
Apesar de funcional, essa abordagem apresentava limita√ß√µes de compatibilidade, estabilidade e complexidade.

Diante disso, realizamos a migra√ß√£o completa para o PyWebview, utilizando sua arquitetura nativa de API Python ‚Üí JavaScript.
O objetivo da migra√ß√£o foi reduzir erros, simplificar o c√≥digo e melhorar a integra√ß√£o entre o Python e o front-end.

2. Motivos da Migra√ß√£o
2.1 Problemas e limita√ß√µes do QWebChannel

O QWebChannel trouxe v√°rios problemas pr√°ticos:

‚ùå Complexidade exagerada

Necessidade de criar arquivos .qml, objetos de ponte e expor m√©todos manualmente.

Comunica√ß√£o baseada em sinais e slots, exigindo configura√ß√£o extra.

‚ùå Erros recorrentes e dif√≠ceis de rastrear

Mensagens de erro como:
"QueryInterface to IDCompositionDevice4 failed"
"TypeError: undefined is not an object"

Esperava que o document estivesse pronto, exigindo sincroniza√ß√£o manual.

‚ùå Depend√™ncia pesada e incompatibilidades

QtWebEngine √© pesado (centenas de MB).

Conflitos de vers√µes com Qt 5, Qt 6, Python 3.13.

Diferentes comportamentos no Windows e Linux.

‚ùå Dificuldade em enviar dados para o JS com estabilidade

Necess√°rio conectar sinais e aguardar readyState no JS.

2.2 Vantagens do PyWebview

A migra√ß√£o para PyWebview trouxe um conjunto de melhorias claras:

‚úî Comunica√ß√£o nativa e simples via API

O PyWebview permite fazer isto:

Python ‚Üí JS

self.window.evaluate_js("alert('Ol√° do Python!')")


JS ‚Üí Python

window.pywebview.api.minha_funcao()


Sem QML, sem canais, sem sinais.

‚úî Mais leve, mais r√°pido, mais est√°vel

PyWebview usa WebKit ou Edge Chromium.

N√£o depende do QtWebEngine, removendo centenas de MB de depend√™ncias.

Reduziu travamentos e logs de erro.

‚úî C√≥digo mais limpo e organizado

O Python ficou organizado em uma classe √∫nica chamada Api, onde todos os m√©todos ficam centralizados:

class Api:
    def converter_xml(self, src, tgt):
        ...

‚úî Chamadas ass√≠ncronas autom√°ticas

O PyWebview cria promessas automaticamente no JS:

window.pywebview.api.converter_xml().then(...)


Sem precisar programar nada extra.

‚úî Melhor suporte para multithreading

PyWebview possui m√©todos pr√≥prios para garantir que threads trabalhem sem travar a GUI, algo que era complicado com Qt.

3. Mudan√ßas realizadas no c√≥digo
3.1 Cria√ß√£o da classe API

Criamos a classe:

class Api:
    def __init__(self, window):
        self.window = window


Nela foram centralizados:

sele√ß√£o de pastas

convers√£o de XML

separa√ß√£o de documentos

atualiza√ß√µes de progresso

retorno para o JavaScript

Todos os m√©todos agora s√£o mais curtos, mais leg√≠veis e sem depend√™ncias externas.

3.2 Substitui√ß√£o total dos sinais do QWebChannel

O que antes era:

self.bridge.progressoAtualizado.emit(pct)


Agora √©:

self.window.evaluate_js(f"window.onProgressoAtualizado({pct})")


Direto, simples e sem risco de race condition.

3.3 Ajustes no JavaScript

Antes o JS dependia disto:

window.pyBridge.progressoAtualizado.connect(...)


Agora o JS s√≥ faz:

window.onProgressoAtualizado = function(pct) {
    ...
}


Mucho mais clean e direto.

3.4 Navega√ß√£o SPA simplificada

O script.js foi reorganizado:

inicializa√ß√£o √∫nica

listeners claros

callbacks vindos do Python

separa√ß√£o de fun√ß√µes de pasta / convers√£o / progresso

O c√≥digo hoje est√° limpo, modular e f√°cil de manter.

3.5 Janela abrindo maximizada automaticamente

Adicionamos:

def init(window):
    window.maximize()


E no start:

webview.start(func=init, args=(window,))


Agora o software abre em modo profissional, ocupando a tela inteira.

4. Impacto da Migra√ß√£o
4.1 Impactos Positivos
üöÄ 1. Estabilidade muito maior

Acabaram:

loops de erros no console

travamentos no QWebChannel

problemas com atraso de sinais

üß† 2. C√≥digo mais f√°cil de dar manuten√ß√£o

A comunica√ß√£o √© direta, n√£o tem camadas escondidas.

üéØ 3. Redu√ß√£o de complexidade

Removemos:

QWebChannel

obj Bridge

importa√ß√µes extras

scripts duplicados

üéõ 4. Maior controle da janela

Agora podemos:

maximizar

fullscreen

redimensionar

manipular a UI

‚öô 5. Melhor compatibilidade

Funciona de forma igual:

Windows

Linux

Mac

Python 3.12/3.13

Qt 6/Edge/Chromium

üîß 6. Multithreading real sem travar o JS

PyWebview executa os m√©todos Python em threads nativas sem congelar a UI.

5. Conclus√£o

A migra√ß√£o do QWebChannel para PyWebview representou um enorme avan√ßo na arquitetura do RobotSystem.

Resumo das melhorias:

‚úî Comunica√ß√£o Python ‚Üî JS mais limpa e simples
‚úî Sistema mais est√°vel e r√°pido
‚úî C√≥digo mais organizado e profissional
‚úî Remo√ß√£o de camadas complexas do Qt
‚úî Interface mais responsiva
‚úî Threads funcionando corretamente
‚úî Melhor experi√™ncia para o usu√°rio final
‚úî Facilita futuras expans√µes do software

O sistema agora est√° mais moderno, sustent√°vel e maduro para evoluir em novas funcionalidades como:

login

dashboard

gr√°ficos

relat√≥rios

integra√ß√µes externas