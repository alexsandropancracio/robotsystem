ğŸ§  O que sÃ£o logs estruturados?
ğŸ“Œ DefiniÃ§Ã£o simples

Logs estruturados sÃ£o logs que nÃ£o sÃ£o texto solto, mas sim dados organizados em campos, normalmente em formato JSON.

ğŸ‘‰ Em vez disso âŒ (log comum / ruim):

Erro ao enviar email para usuÃ¡rio


ğŸ‘‰ Fazemos isso âœ… (log estruturado):

{
  "level": "error",
  "event": "email_send_failed",
  "user_email": "alex@email.com",
  "service": "activation_token",
  "error": "SMTPAuthenticationError"
}

ğŸ¤” Por que logs â€œnormaisâ€ nÃ£o sÃ£o suficientes?

Logs soltos:

difÃ­ceis de filtrar

difÃ­ceis de buscar

impossÃ­veis de analisar automaticamente

ruins para produÃ§Ã£o

ğŸ“Œ Exemplo real:

â€œQuais usuÃ¡rios tiveram falha ao receber e-mail hoje?â€

âŒ Com texto solto â†’ impossÃ­vel
âœ… Com logs estruturados â†’ trivial

ğŸ§© O que um log estruturado normalmente contÃ©m?

Campos comuns (padrÃ£o profissional):

Campo	O que significa
level	info / warning / error
event	nome curto do que aconteceu
service	qual serviÃ§o gerou o log
endpoint	rota da API
user_id	se houver
email	se houver
ip	se houver
error	mensagem de erro
timestamp	quando aconteceu
ğŸ”’ SeguranÃ§a: o que NÃƒO logar

Muito importante âš ï¸

âŒ NUNCA logar:

senha

token de ativaÃ§Ã£o

token JWT

refresh token

cÃ³digo enviado por e-mail

ğŸ“Œ Regra de ouro:

Logue contexto, nÃ£o segredo

ğŸ§  Onde logs estruturados entram no seu projeto?

No RobotSystem, eles entram principalmente em:

ğŸ” Auth (login, activation, reset)

ğŸ“§ Envio de e-mail

ğŸš« Rate limit

âŒ ExceÃ§Ãµes

ğŸ” Auditoria bÃ¡sica

Exemplo real do seu fluxo atual:

ğŸ“ /auth/send-activation

Logs ideais:

1ï¸âƒ£ Tentativa de envio
2ï¸âƒ£ Bloqueio por rate limit
3ï¸âƒ£ Falha no SMTP
4ï¸âƒ£ Sucesso no envio

Tudo isso sem nunca mostrar o token.

ğŸ§  Exemplo mental aplicado ao seu endpoint

Quando alguÃ©m chama:

POST /auth/send-activation


O sistema deveria gerar logs como:

{
  "level": "info",
  "event": "activation_email_requested",
  "email": "user@email.com",
  "ip": "187.xxx.xxx.xxx"
}


Se bater no rate limit:

{
  "level": "warning",
  "event": "rate_limit_exceeded",
  "endpoint": "/auth/send-activation",
  "ip": "187.xxx.xxx.xxx.xxx"
}


Se SMTP falhar:

{
  "level": "error",
  "event": "activation_email_send_failed",
  "email": "user@email.com",
  "error": "SMTPAuthenticationError"
}

ğŸš€ Por que isso Ã© nÃ­vel profissional?

Logs estruturados permitem:

integraÃ§Ã£o com ELK (Elastic)

Datadog

Grafana Loki

CloudWatch

alertas automÃ¡ticos

auditoria

debug rÃ¡pido em produÃ§Ã£o

ğŸ“Œ Empresas grandes nÃ£o debuggam com print.

ğŸ” Resumo em uma frase

Logs estruturados sÃ£o logs pensados para mÃ¡quinas e humanos analisarem, nÃ£o apenas para â€œver no terminalâ€.

âŒ Logs estruturados NÃƒO sÃ£o sÃ³ para endpoints

Endpoints sÃ£o apenas um dos lugares onde logs estruturados fazem sentido.

ğŸ‘‰ Pense assim:

Logs estruturados servem para observar o comportamento do sistema inteiro, nÃ£o sÃ³ da API.

ğŸ§  Onde logs estruturados DEVEM existir?
1ï¸âƒ£ Endpoints (camada de entrada)

Sim, aqui eles sÃ£o importantes, porque:

vocÃª sabe quem chamou

quando

qual rota

qual IP

qual status

ğŸ“Œ Exemplo:

{
  "event": "request_received",
  "endpoint": "/auth/send-activation",
  "method": "POST",
  "ip": "187.xxx.xxx.xxx"
}

2ï¸âƒ£ Services (camada de negÃ³cio) â­ï¸â­ï¸â­ï¸

Aqui Ã© o coraÃ§Ã£o do sistema.

Ã‰ onde vocÃª registra:

regras de negÃ³cio

decisÃµes importantes

fluxos crÃ­ticos

falhas reais

ğŸ“Œ Exemplo no ActivationTokenService:

{
  "event": "activation_token_created",
  "user_id": 42,
  "expires_in_minutes": 15
}


ğŸ“Œ Ou erro:

{
  "event": "activation_token_creation_failed",
  "user_id": 42,
  "reason": "user_already_active"
}

3ï¸âƒ£ Repositories (com MUITO cuidado)

Aqui os logs sÃ£o:

raros

bem pontuais

geralmente erros inesperados

âŒ NÃ£o logamos:

queries normais

fluxo esperado

âœ… Logamos:

falhas de integridade

erros de banco

estados impossÃ­veis

ğŸ“Œ Exemplo:

{
  "event": "database_constraint_error",
  "table": "activation_tokens",
  "error": "foreign_key_violation"
}

4ï¸âƒ£ Infra / IntegraÃ§Ãµes externas (SMTP, APIs)

Essencial ğŸ”¥

SMTP, por exemplo:

Ã© instÃ¡vel

falha por credencial

falha por rede

falha por spam

ğŸ“Œ Exemplo:

{
  "event": "smtp_send_failed",
  "provider": "smtp.gmail.com",
  "error": "AuthenticationError"
}

5ï¸âƒ£ SeguranÃ§a (auth, rate limit, tentativas suspeitas)

Aqui logs sÃ£o quase auditoria.

ğŸ“Œ Exemplo:

{
  "event": "rate_limit_exceeded",
  "endpoint": "/auth/send-activation",
  "ip": "187.xxx.xxx.xxx"
}


ğŸ“Œ Ou:

{
  "event": "invalid_activation_token_attempt",
  "email": "user@email.com"
}

ğŸ”¥ O erro comum (que vocÃª estÃ¡ evitando ğŸ‘)

âŒ Pensar:

â€œlog Ã© sÃ³ pra request e responseâ€

Isso vira:

logs inÃºteis

ruÃ­do

nenhum insight real

ğŸ§  Regra mental simples (anota essa)

Toda decisÃ£o importante do sistema merece um log.

Se o sistema:

decide negar algo

gera algo

envia algo

falha em algo

protege algo

ğŸ‘‰ isso merece um log.

ğŸ§© No seu projeto RobotSystem, logs entram em:
Camada	Usa logs estruturados?

routes/	        âœ…
services/	âœ… (principal)
repositories/	âš ï¸ raramente
core/mail/	âœ…
core/security/	âœ…
rate limit	âœ…