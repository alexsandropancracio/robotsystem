# Relat√≥rio T√©cnico ‚Äì Funcionalidade **Separator (PDF)**

## 1. Vis√£o Geral

Este documento descreve, de forma **t√©cnica, detalhada e profissional**, a implementa√ß√£o da funcionalidade **Separator de Documentos PDF por Termos** no projeto **RobotSystem**.

O objetivo principal da funcionalidade √©:

* Ler documentos PDF a partir de uma pasta de origem
* Identificar conte√∫dos textuais com base em **par√¢metros informados pelo usu√°rio**
* Copiar os PDFs correspondentes para uma pasta de destino
* Atualizar o progresso no front-end em tempo real
* Garantir separa√ß√£o clara entre **camada de servi√ßo**, **camada de API** e **camada de interface (JS)**

A solu√ß√£o foi constru√≠da respeitando **boas pr√°ticas de engenharia de software**, incluindo desacoplamento, responsabilidade √∫nica, previsibilidade de estados e observabilidade via logs.

---

## 2. Arquitetura Geral

### 2.1 Camadas Envolvidas

A funcionalidade est√° distribu√≠da em tr√™s camadas bem definidas:

```
UI (HTML / JS)
   ‚Üì
API (PyWebView ‚Äì api_services.py)
   ‚Üì
Servi√ßo de Dom√≠nio (separator.py)
```

### 2.2 Responsabilidades

| Camada                 | Responsabilidade                                                                    |
| ---------------------- | ----------------------------------------------------------------------------------- |
| UI (JS)                | Intera√ß√£o com usu√°rio, valida√ß√£o visual, controle de estado e exibi√ß√£o de progresso |
| API (ServicesAPI)      | Orquestra√ß√£o, valida√ß√µes, c√°lculo de progresso e comunica√ß√£o JS ‚Üî Python            |
| Servi√ßo (separator.py) | Regra de neg√≥cio pura: leitura de PDFs e separa√ß√£o por termos                       |

---

## 3. Problema Inicial Identificado

Durante o desenvolvimento inicial, foram observados os seguintes problemas arquiteturais:

* Progresso sendo calculado **dentro do servi√ßo** (`separator.py`)
* Uso de callbacks misturados entre servi√ßo e API
* Assinaturas de fun√ß√µes inconsistentes
* Fun√ß√µes n√£o expostas corretamente no `js_api`
* Erros de runtime como:

  * `TypeError: separar_documentos() is not a function`
  * `unexpected keyword argument 'parametro'`

Esses sintomas indicavam **acoplamento indevido** entre camadas e viola√ß√£o do princ√≠pio de responsabilidade √∫nica.

---

## 4. Decis√£o Arquitetural

### 4.1 Princ√≠pio Adotado

> **Servi√ßos n√£o devem conhecer UI nem progresso visual.**

Portanto:

* `separator.py` passou a ser um **servi√ßo puro**
* Toda l√≥gica de progresso foi movida para a **API (ServicesAPI)**
* A API passou a controlar o loop, o progresso e a comunica√ß√£o com o front-end

Essa decis√£o trouxe:

* Previsibilidade
* Testabilidade
* Reutiliza√ß√£o
* Elimina√ß√£o de progresso ‚Äúfake‚Äù

---

## 5. Implementa√ß√£o do Servi√ßo (separator.py)

### 5.1 Caracter√≠sticas

* N√£o conhece JS
* N√£o conhece PyWebView
* N√£o emite progresso
* N√£o faz valida√ß√£o de UI

### 5.2 Responsabilidade √önica

O servi√ßo executa apenas:

* Leitura de PDFs
* Extra√ß√£o de texto
* Normaliza√ß√£o de texto (unidecode + lowercase)
* Verifica√ß√£o de termos
* C√≥pia de arquivos

### 5.3 Fluxo Interno

1. Valida√ß√£o de par√¢metros
2. Varredura recursiva por PDFs
3. Leitura do conte√∫do textual
4. Match por termos
5. C√≥pia para pasta destino
6. Retorno de resultado textual

---

## 6. Implementa√ß√£o da API (api_services.py)

### 6.1 Papel da API

A API atua como **orquestradora** entre:

* UI (JS)
* Servi√ßo de separa√ß√£o

Ela √© respons√°vel por:

* Validar entradas
* Listar arquivos
* Controlar o loop de processamento
* Calcular progresso real
* Enviar progresso ao front-end

### 6.2 Loop Controlado

```python
for i, arquivo in enumerate(arquivos, start=1):
    separar_documentos_por_termos(...)
    pct = int((i / total) * 100)
    atualizar_progresso(pct)
```

Isso garante:

* Progresso proporcional real
* Atualiza√ß√£o previs√≠vel
* Sem depend√™ncia interna do servi√ßo

---

## 7. Comunica√ß√£o com o Front-End

### 7.1 Atualiza√ß√£o de Progresso

A comunica√ß√£o √© feita via:

```python
self.window.evaluate_js(
    f"window.atualizarProgressoSeparator({pct});"
)
```

Com prote√ß√£o defensiva:

```python
if hasattr(self, "window") and self.window:
```

---

## 8. Controle de Estado no Front-End

### 8.1 Par√¢metro Confirmado

Foi implementado um **estado expl√≠cito** para o par√¢metro:

* `window.PARAMETRO_CONFIRMED`
* `window.PARAMETRO_CONFIRMED_VALUE`

### 8.2 Invalida√ß√£o Autom√°tica

Qualquer altera√ß√£o no input invalida a confirma√ß√£o, garantindo:

* Coer√™ncia entre UI e backend
* Elimina√ß√£o de erros silenciosos
* UX profissional

---

## 9. Observabilidade e Logs

### 9.1 Logs Estruturados

Exemplos:

```text
[SEPARADOR] Iniciando separa√ß√£o
[SEPARADOR][PROGRESS] 62%
[SEPARADOR] Finalizado | 18/18 arquivos processados
```

Benef√≠cios:

* Debug r√°pido
* Auditoria de execu√ß√£o
* Diagn√≥stico em produ√ß√£o

---

## 10. Erros Resolvidos Durante o Processo

| Erro                    | Causa                   | Solu√ß√£o                       |
| ----------------------- | ----------------------- | ----------------------------- |
| fun√ß√£o n√£o encontrada   | API n√£o exposta         | Uso correto de `api.services` |
| keyword inesperada      | Assinaturas divergentes | Padroniza√ß√£o da fun√ß√£o        |
| progresso inconsistente | Progresso no servi√ßo    | Centraliza√ß√£o na API          |

---

## 11. Estado Final da Funcionalidade

‚úÖ Separa√ß√£o funcional

‚úÖ Progresso real

‚úÖ Arquitetura limpa

‚úÖ Servi√ßo desacoplado

‚úÖ API previs√≠vel

‚úÖ UX consistente

---

## 12. Conclus√£o

A funcionalidade **Separator** atingiu um n√≠vel de maturidade compat√≠vel com **aplica√ß√µes profissionais desktop**, seguindo padr√µes que engenheiros de software experientes utilizam em produ√ß√£o.

A separa√ß√£o clara de responsabilidades, aliada a um controle expl√≠cito de estado e progresso, elimina classes inteiras de bugs e torna o sistema sustent√°vel para evolu√ß√£o futura.

Este m√≥dulo est√° **pronto para escala, manuten√ß√£o e testes automatizados**.

---

üìå *Relat√≥rio elaborado com foco em engenharia de software, arquitetura limpa e boas pr√°ticas.*
